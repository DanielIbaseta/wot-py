pipelines:
  default:
    - step:
        image: python:2.7
        script:
          - pip install -U .[tests]
          - pytest -sv --cov=wotpy
    - step:
        image: python:3.6
        script:
          - pip install -U .[tests]
          - pytest -sv --cov=wotpy
        services:
          - mosquitto
        environment:
          WOTPY_TESTS_MQTT_BROKER_URL: mqtt://mosquitto
    - step:
        image: python:3.7
        script:
          - pip install -U .[tests]
          - pytest -sv --cov=wotpy
        services:
          - mosquitto
        environment:
          WOTPY_TESTS_MQTT_BROKER_URL: mqtt://mosquitto
definitions:
  services:
    mosquitto:
      image: agmangas/mosquitto-websockets